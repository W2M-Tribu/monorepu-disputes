openapi: 3.0.3
info:
  title: W2M Disputes API (Alta)
  version: 1.0.0
  description: Especificación OpenAPI para los endpoints de alta basados en la colección Postman.
servers:
  - url: http://localhost:8080/api/v1
    description: Local (8080)
  - url: https://tst-api.internal.w2m.com/dispute/api/v1
    description: TST
paths:
  /bp-manager/check:
    post:
      tags:
        - BP Manager
      summary: Comprobar si un BP existe o es válido
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BpCheckRequest'
            examples:
              known:
                value:
                  bp: "900017562"
              unknown:
                value:
                  bp: "67"
              error:
                value:
                  bp: "fail"
      responses:
        '200':
          description: Resultado de la comprobación del BP
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BpCheckResponse'
              examples:
                known:
                  value:
                    bp: "900017562"
                    known: true
                    status: KNOWN
                    message: "BP encontrado"
                unknown:
                  value:
                    bp: "67"
                    known: false
                    status: UNKNOWN
                    message: "BP no encontrado"
        '400':
          description: Petición inválida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid:
                  value:
                    code: 400
                    message: "Formato de BP inválido"
        '404':
          description: BP no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_found:
                  value:
                    code: 404
                    message: "BP no encontrado"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /dispute-creation/create:
    post:
      tags:
        - Dispute Creation
      summary: Alta de disputas a partir de un fichero Excel
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                data:
                  $ref: '#/components/schemas/CreateMetadata'
                file:
                  type: string
                  format: binary
              required:
                - data
                - file
            encoding:
              data:
                contentType: application/json
        
      responses:
        '201':
          description: Disputa(s) creada(s) correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreationResult'
              examples:
                created:
                  value:
                    bp: "900017561"
                    acceptedRows: 42
                    rejectedRows: 3
                    warnings:
                      - "Fila 7 con email inválido"
                    message: "Proceso completado"
        '400':
          description: Error de validación o entrada incorrecta
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_fields:
                  value:
                    code: 400
                    message: "Faltan campos requeridos en 'data'"
        '404':
          description: BP no encontrado o no gestionable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                bp_not_found:
                  value:
                    code: 404
                    message: "BP no encontrado"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    BpCheckRequest:
      type: object
      properties:
        bp:
          type: string
      required:
        - bp
    BpCheckResponse:
      type: object
      properties:
        bp:
          type: string
        known:
          type: boolean
        status:
          type: string
          enum:
            - KNOWN
            - UNKNOWN
        message:
          type: string
      required:
        - bp
        - known
        - status
    CreateMetadata:
      type: object
      properties:
        bp:
          type: string
        emails:
          type: array
          items:
            type: string
            format: email
      required:
        - emails
    CreationResult:
      type: object
      properties:
        bp:
          type: string
        acceptedRows:
          type: integer
          format: int32
        rejectedRows:
          type: integer
          format: int32
        warnings:
          type: array
          items:
            type: string
        message:
          type: string
      required:
        - acceptedRows
        - rejectedRows
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        details:
          type: object
